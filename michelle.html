<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cl√≠nica Serenity - Sistema de Prontu√°rios</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-soft: #f4f7f6;
            --mint: #e8f5e9;
            --mint-dark: #81c784;
            --lavender: #f3e5f5;
            --lavender-dark: #ba68c8;
            --peach: #fff3e0;
            --text: #455a64;
            --white: #ffffff;
            --overlay: rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-soft);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        nav {
            background: var(--white);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        nav button {
            padding: 10px 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            border-radius: 20px;
            color: var(--text);
            transition: 0.3s;
        }

        nav button.active { background: var(--mint); color: var(--mint-dark); font-weight: 700; }

        .screen { display: none; padding: 30px; flex: 1; }
        .screen.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: var(--white); padding: 30px; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.02); margin-bottom: 20px; }

        h2 { font-weight: 500; color: var(--mint-dark); margin-bottom: 20px; border-bottom: 1px solid var(--mint); padding-bottom: 10px; }

        .form-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .span-2 { grid-column: span 2; }
        .span-3 { grid-column: span 3; }

        .form-group { display: flex; flex-direction: column; }
        label { font-size: 0.85rem; font-weight: 500; margin-bottom: 4px; }

        input, select, textarea {
            width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;
            font-family: inherit; box-sizing: border-box; background: #fafafa;
        }

        .checkbox-group { display: flex; align-items: center; gap: 15px; padding-top: 25px; }
        .checkbox-group label { display: flex; align-items: center; gap: 5px; cursor: pointer; }

        button.btn-save {
            background: var(--mint-dark); color: white; border: none; padding: 15px;
            width: 100%; border-radius: 10px; cursor: pointer; font-weight: 700; margin-top: 25px;
            transition: 0.3s;
        }

        /* Agenda */
        .timeline-item {
            display: flex; align-items: center; background: white; margin-bottom: 8px;
            padding: 15px 25px; border-radius: 15px; border-left: 5px solid #eee;
        }
        .timeline-item.free { border-left-color: var(--mint-dark); cursor: pointer; }
        .timeline-item.occupied { border-left-color: var(--lavender-dark); background: var(--lavender); }
        .time-slot { font-weight: 700; width: 80px; }
        .patient-name { flex: 1; }

        /* Modal */
        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay); z-index: 100; justify-content: center; align-items: center; backdrop-filter: blur(3px);
        }
        .modal { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; }

        /* Prontu√°rios Hist√≥rico */
        .hist-item { background: white; padding: 20px; border-radius: 15px; border-left: 5px solid var(--lavender-dark); margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .hist-header { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--lavender-dark); font-weight: bold; margin-bottom: 10px; }
        .hist-section-title { font-size: 0.75rem; text-transform: uppercase; color: #90a4ae; margin-top: 10px; font-weight: 700; }
        .hist-content { font-size: 0.95rem; line-height: 1.5; color: var(--text); margin-bottom: 10px; }

        footer { text-align: center; padding: 20px; font-size: 0.9rem; color: #90a4ae; }
        footer strong { color: var(--mint-dark); }
    </style>
</head>
<body>

    <nav>
        <button onclick="showScreen('screen-agenda')" id="nav-agenda" class="active">üìÖ Agenda</button>
        <button onclick="showScreen('screen-cadastro')" id="nav-cadastro">üë§ Cadastro</button>
        <button onclick="showScreen('screen-prontuario')" id="nav-prontuario">üìù Prontu√°rio</button>
        <button onclick="showScreen('screen-historico')" id="nav-historico">üìö Hist√≥rico</button>
    </nav>

    <div id="overlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h3 style="color: var(--mint-dark)">Agendar Hor√°rio</h3>
            <p id="modal-horario-info"></p>
            <select id="sel-paciente-modal"></select>
            <button class="btn-save" onclick="confirmarAgendamentoRapido()">Confirmar</button>
        </div>
    </div>

    <section id="screen-agenda" class="screen active">
        <div class="container">
            <div style="text-align:center; margin-bottom:20px;">
                Dia: <input type="date" id="filtro-data" onchange="renderTimeline()">
            </div>
            <div id="timeline-container"></div>
        </div>
    </section>

    <section id="screen-cadastro" class="screen">
        <div class="container">
            <div class="card">
                <h2>Cadastro do Paciente</h2>
                <div class="form-grid">
                    <div class="form-group span-2"><label>Nome Completo</label><input type="text" id="c-nome"></div>
                    <div class="form-group"><label>CPF</label><input type="text" id="c-cpf"></div>
                    <div class="form-group"><label>Nascimento</label><input type="date" id="c-nasc" onchange="calcularIdadeAuto()"></div>
                    <div class="form-group"><label>Idade</label><input type="text" id="c-idade" readonly></div>
                    <div class="form-group"><label>Sexo</label><select id="c-sexo"><option>Feminino</option><option>Masculino</option><option>Outro</option></select></div>
                    <div class="form-group"><label>Profiss√£o</label><input type="text" id="c-profissao"></div>
                    <div class="form-group"><label>Estado Civil</label><select id="c-civil"><option>Solteiro(a)</option><option>Casado(a)</option><option>Divorciado(a)</option><option>Vi√∫vo(a)</option></select></div>
                    <div class="form-group"><label>Telefone</label><input type="text" id="c-tel"></div>
                    <div class="form-group span-2"><label>E-mail</label><input type="email" id="c-email"></div>
                    <div class="form-group"><label>Endere√ßo</label><input type="text" id="c-end"></div>
                    <div class="form-group span-2"><label>Nome de Familiar (Emerg√™ncia)</label><input type="text" id="c-fam-nome"></div>
                    <div class="form-group"><label>Telefone Familiar</label><input type="text" id="c-fam-tel"></div>
                    <div class="form-group"><label>Valor Sess√£o (R$)</label><input type="number" id="c-valor-sessao"></div>
                    <div class="checkbox-group">
                        <label>Pacote?</label>
                        <label><input type="radio" name="pacote" value="sim"> Sim</label>
                        <label><input type="radio" name="pacote" value="nao" checked> N√£o</label>
                    </div>
                    <div class="form-group"><label>Valor do Pacote (R$)</label><input type="number" id="c-valor-pacote"></div>
                    <div class="checkbox-group">
                        <label>Recibo?</label>
                        <label><input type="radio" name="recibo" value="sim"> Sim</label>
                        <label><input type="radio" name="recibo" value="nao" checked> N√£o</label>
                    </div>
                    <div class="form-group span-3"><label>Observa√ß√£o Cl√≠nica Inicial</label><textarea id="c-obs" rows="2"></textarea></div>
                </div>
                <button class="btn-save" onclick="salvarPaciente()">Salvar Prontu√°rio</button>
            </div>
        </div>
    </section>

    <section id="screen-prontuario" class="screen">
        <div class="container">
            <div class="card">
                <h2>Registrar Prontu√°rio</h2>
                <label>Paciente</label><select id="sel-paciente-pr"></select>
                
                <div class="form-group" style="margin-top:20px;">
                    <label>S√≠ntese do Atendimento</label>
                    <textarea id="pr-sintese" rows="4" placeholder="Breve resumo da sess√£o..."></textarea>
                </div>

                <div class="form-group" style="margin-top:20px;">
                    <label>Registro e Evolu√ß√£o do Paciente</label>
                    <textarea id="pr-evolucao" rows="8" placeholder="Detalhes t√©cnicos, observa√ß√µes e evolu√ß√£o..."></textarea>
                </div>

                <button class="btn-save" style="background: var(--lavender-dark);" onclick="salvarProntuarioSessao()">Salvar Prontu√°rio</button>
            </div>
        </div>
    </section>

    <section id="screen-historico" class="screen">
        <div class="container">
            <div class="card">
                <h2>Hist√≥rico de Prontu√°rios</h2>
                <select id="sel-paciente-hist" onchange="renderHistorico()"></select>
                <div id="lista-prontuarios" style="margin-top:20px;"></div>
            </div>
        </div>
    </section>

    <footer>Desenvolvido por <strong>Carlos Almeida</strong> &copy; 2026</footer>

    <script>
        let pacientes = JSON.parse(localStorage.getItem('db_pacientes_serenity')) || [];
        let consultas = JSON.parse(localStorage.getItem('db_consultas_serenity')) || [];
        let historico = JSON.parse(localStorage.getItem('db_historico_serenity')) || [];
        let slotSelecionado = null;

        document.getElementById('filtro-data').valueAsDate = new Date();

        function calcularIdadeAuto() {
            const nasc = document.getElementById('c-nasc').value;
            if(!nasc) return;
            const hoje = new Date();
            const nascData = new Date(nasc);
            let idade = hoje.getFullYear() - nascData.getFullYear();
            if (hoje.getMonth() < nascData.getMonth() || (hoje.getMonth() === nascData.getMonth() && hoje.getDate() < nascData.getDate())) idade--;
            document.getElementById('c-idade').value = idade + " anos";
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('nav-' + id.split('-')[1]).classList.add('active');
            popularSelects();
            if(id === 'screen-agenda') renderTimeline();
        }

        function popularSelects() {
            const ids = ['sel-paciente-modal', 'sel-paciente-pr', 'sel-paciente-hist'];
            ids.forEach(id => {
                const s = document.getElementById(id);
                s.innerHTML = '<option value="">--- Selecione o Paciente ---</option>';
                pacientes.forEach((p, i) => s.innerHTML += `<option value="${i}">${p.nome}</option>`);
            });
        }

        function salvarPaciente() {
            const p = {
                nome: document.getElementById('c-nome').value,
                nascimento: document.getElementById('c-nasc').value,
                idade: document.getElementById('c-idade').value,
                cpf: document.getElementById('c-cpf').value,
                obs_clinica: document.getElementById('c-obs').value
            };
            if(!p.nome) return alert("Nome √© obrigat√≥rio");
            pacientes.push(p);
            localStorage.setItem('db_pacientes_serenity', JSON.stringify(pacientes));
            alert("Paciente Cadastrado!");
            showScreen('screen-agenda');
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            const dataFiltro = document.getElementById('filtro-data').value;
            container.innerHTML = "";
            for(let h = 8; h <= 18; h++) {
                const hora = h.toString().padStart(2, '0') + ":00";
                const ag = consultas.find(c => c.data === dataFiltro && c.hora === hora);
                const div = document.createElement('div');
                div.className = `timeline-item ${ag ? 'occupied' : 'free'}`;
                div.innerHTML = `<div class="time-slot">${hora}</div><div class="patient-name">${ag ? ag.paciente : 'Livre'}</div>`;
                if(!ag) div.onclick = () => { slotSelecionado = {data: dataFiltro, hora: hora}; document.getElementById('overlay').style.display='flex'; };
                container.appendChild(div);
            }
        }

        function confirmarAgendamentoRapido() {
            const pIdx = document.getElementById('sel-paciente-modal').value;
            if(!pIdx) return;
            consultas.push({ paciente: pacientes[pIdx].nome, data: slotSelecionado.data, hora: slotSelecionado.hora });
            localStorage.setItem('db_consultas_serenity', JSON.stringify(consultas));
            document.getElementById('overlay').style.display='none';
            renderTimeline();
        }

        function salvarProntuarioSessao() {
            const pIdx = document.getElementById('sel-paciente-pr').value;
            const sintese = document.getElementById('pr-sintese').value;
            const evolucao = document.getElementById('pr-evolucao').value;
            
            if(!pIdx || !sintese || !evolucao) return alert("Por favor, preencha todos os campos.");

            historico.push({
                nome: pacientes[pIdx].nome,
                data: new Date().toLocaleDateString('pt-BR'),
                hora: new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'}),
                sintese: sintese,
                evolucao: evolucao
            });

            localStorage.setItem('db_historico_serenity', JSON.stringify(historico));
            alert("Prontu√°rio salvo com sucesso!");
            document.getElementById('pr-sintese').value = "";
            document.getElementById('pr-evolucao').value = "";
            showScreen('screen-historico');
        }

        function renderHistorico() {
            const pIdx = document.getElementById('sel-paciente-hist').value;
            const container = document.getElementById('lista-prontuarios');
            container.innerHTML = "";
            if(pIdx === "") return;

            const filtrados = historico.filter(h => h.nome === pacientes[pIdx].nome);
            if(filtrados.length === 0) { container.innerHTML = "Nenhum prontu√°rio registrado."; return; }

            filtrados.reverse().forEach(h => {
                container.innerHTML += `
                    <div class="hist-item">
                        <div class="hist-header"><span>Sess√£o: ${h.data}</span> <span>${h.hora}</span></div>
                        
                        <div class="hist-section-title">S√≠ntese do Atendimento:</div>
                        <div class="hist-content">${h.sintese}</div>
                        
                        <div class="hist-section-title">Registro e Evolu√ß√£o:</div>
                        <div class="hist-content">${h.evolucao}</div>
                    </div>`;
            });
        }

        renderTimeline();
        popularSelects();
    </script>
</body>
</html>
